<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#0a1628">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="JBLM Scout">
<link rel="manifest" href="manifest.json">
<script>if('serviceWorker' in navigator){window.addEventListener('load',()=>{navigator.serviceWorker.register('./sw.js').catch(()=>{})})}</script>
<title>JBLM Scout â€” Live Adventure Guide</title>
<link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@400;600;700;900&family=Barlow:wght@300;400;500;600&display=swap" rel="stylesheet">

<style>
:root {
  --dark: #07111f;
  --surface: #0e1d2e;
  --surface2: #162539;
  --surface3: #1d2f47;
  --green: #39ff7a;
  --amber: #ffb703;
  --red: #ff4455;
  --blue: #00c2e0;
  --purple: #9b72ff;
  --border: rgba(57,255,122,0.12);
  --text: #ddeeff;
  --dim: #7a9ab8;
  --white: #ffffff;
  --radius: 14px;
  --ease: cubic-bezier(0.4,0,0.2,1);
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html{scroll-behavior:smooth}
body{
  font-family:'Barlow',sans-serif;
  background:var(--dark);
  color:var(--text);
  min-height:100vh;
  overflow-x:hidden;
}
body::before{
  content:'';position:fixed;inset:0;
  background:
    radial-gradient(ellipse 80% 50% at 20% -10%, rgba(57,255,122,0.06) 0%, transparent 60%),
    radial-gradient(ellipse 60% 40% at 80% 110%, rgba(0,194,224,0.05) 0%, transparent 60%);
  pointer-events:none;z-index:0;
}

/* â”€â”€ SETUP SCREEN â”€â”€ */
#setupScreen{
  position:fixed;inset:0;z-index:500;
  background:var(--dark);
  display:flex;align-items:center;justify-content:center;
  padding:24px;
}
.setup-card{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:20px;
  padding:32px 24px;
  max-width:480px;width:100%;
  text-align:center;
}
.setup-icon{font-size:52px;margin-bottom:16px}
.setup-title{
  font-family:'Barlow Condensed',sans-serif;
  font-size:30px;font-weight:900;color:var(--white);
  margin-bottom:8px;
}
.setup-sub{font-size:14px;color:var(--dim);line-height:1.6;margin-bottom:24px}
.setup-steps{text-align:left;margin-bottom:24px}
.setup-step{
  display:flex;gap:12px;align-items:flex-start;
  padding:10px 0;border-bottom:1px solid rgba(255,255,255,0.06);
}
.setup-step:last-child{border-bottom:none}
.step-num{
  width:24px;height:24px;border-radius:50%;
  background:rgba(57,255,122,0.15);border:1px solid rgba(57,255,122,0.3);
  color:var(--green);font-size:12px;font-weight:700;
  display:flex;align-items:center;justify-content:center;flex-shrink:0;margin-top:2px;
}
.step-text{font-size:13px;color:var(--text);line-height:1.5}
.step-text a{color:var(--green);text-decoration:none}
.step-text strong{color:var(--white)}
.api-input-wrap{position:relative;margin-bottom:16px}
.api-input{
  width:100%;
  background:var(--surface2);
  border:1px solid var(--border);
  border-radius:10px;
  padding:14px 16px;
  color:var(--white);
  font-family:'Barlow',sans-serif;
  font-size:14px;
  outline:none;
  transition:.2s;
}
.api-input:focus{border-color:rgba(57,255,122,0.5);background:var(--surface3)}
.api-input::placeholder{color:var(--dim)}
.btn-primary{
  width:100%;
  background:var(--green);
  color:var(--dark);
  border:none;
  border-radius:10px;
  padding:15px;
  font-family:'Barlow Condensed',sans-serif;
  font-size:18px;font-weight:700;letter-spacing:0.5px;
  cursor:pointer;
  transition:.2s var(--ease);
}
.btn-primary:hover{filter:brightness(1.1);transform:translateY(-1px)}
.btn-secondary{
  width:100%;margin-top:10px;
  background:transparent;
  color:var(--dim);
  border:1px solid rgba(255,255,255,0.1);
  border-radius:10px;
  padding:12px;
  font-family:'Barlow',sans-serif;
  font-size:13px;cursor:pointer;transition:.2s;
}
.btn-secondary:hover{color:var(--text);border-color:rgba(255,255,255,0.2)}
.setup-error{
  color:var(--red);font-size:12px;
  margin-top:8px;display:none;
}

/* â”€â”€ HEADER â”€â”€ */
.app-header{
  position:sticky;top:0;z-index:100;
  background:rgba(7,17,31,0.92);
  backdrop-filter:blur(20px);
  border-bottom:1px solid var(--border);
}
.header-inner{
  display:flex;align-items:center;justify-content:space-between;
  height:58px;padding:0 16px;
  max-width:800px;margin:0 auto;
}
.logo{display:flex;align-items:center;gap:10px}
.logo-icon{
  width:34px;height:34px;border-radius:8px;
  background:linear-gradient(135deg,var(--green),#0fa855);
  display:flex;align-items:center;justify-content:center;font-size:17px;
}
.logo-name{
  font-family:'Barlow Condensed',sans-serif;
  font-size:21px;font-weight:900;letter-spacing:0.5px;color:var(--white);
}
.logo-tag{font-size:9px;color:var(--green);letter-spacing:2px;font-weight:600;text-transform:uppercase;display:block;line-height:1}
.live-badge{
  display:flex;align-items:center;gap:6px;
  background:rgba(57,255,122,0.1);
  border:1px solid rgba(57,255,122,0.25);
  border-radius:20px;
  padding:4px 10px;
  font-size:11px;color:var(--green);font-weight:600;
  cursor:pointer;
}
.live-dot{width:6px;height:6px;background:var(--green);border-radius:50%;animation:blink 1.5s infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:0.3}}

/* â”€â”€ NAV TABS â”€â”€ */
.nav-bar{
  position:fixed;bottom:0;left:0;right:0;z-index:150;
  background:rgba(7,17,31,0.96);backdrop-filter:blur(20px);
  border-top:1px solid var(--border);
  display:flex;
  padding:6px 0 max(6px,env(safe-area-inset-bottom));
}
.nav-btn{
  flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;
  padding:6px 4px;border:none;background:none;
  color:var(--dim);cursor:pointer;transition:.2s;
}
.nav-btn.active{color:var(--green)}
.nav-icon{font-size:19px;line-height:1}
.nav-label{font-size:10px;font-weight:600;letter-spacing:0.5px;text-transform:uppercase}

/* â”€â”€ VIEWS â”€â”€ */
.view{display:none;padding-bottom:85px;position:relative;z-index:1}
.view.active{display:block}

/* â”€â”€ HERO â”€â”€ */
.hero{
  padding:24px 16px 20px;
  background:linear-gradient(180deg,rgba(26,58,42,0.4) 0%,transparent 100%);
  border-bottom:1px solid var(--border);
  max-width:800px;margin:0 auto;
}
.hero-eyebrow{
  display:inline-flex;align-items:center;gap:6px;
  background:rgba(57,255,122,0.1);border:1px solid rgba(57,255,122,0.25);
  color:var(--green);font-size:10px;font-weight:700;letter-spacing:2px;
  text-transform:uppercase;padding:4px 10px;border-radius:20px;margin-bottom:12px;
}
.hero h1{
  font-family:'Barlow Condensed',sans-serif;
  font-size:36px;font-weight:900;color:var(--white);line-height:1.05;margin-bottom:6px;
}
.hero h1 em{color:var(--green);font-style:normal}
.hero p{font-size:13px;color:var(--dim);line-height:1.5;margin-bottom:16px}
.hero-stats{display:flex;gap:0}
.hero-stat{
  flex:1;text-align:center;padding:12px 8px;
  border-right:1px solid var(--border);
}
.hero-stat:last-child{border-right:none}
.stat-val{font-family:'Barlow Condensed',sans-serif;font-size:24px;font-weight:900;color:var(--amber);line-height:1}
.stat-lbl{font-size:9px;color:var(--dim);text-transform:uppercase;letter-spacing:1px;margin-top:2px}
.hero-stats-wrap{
  background:var(--surface);border:1px solid var(--border);
  border-radius:var(--radius);overflow:hidden;
}

/* â”€â”€ SECTION â”€â”€ */
.section{padding:20px 16px 0;max-width:800px;margin:0 auto}
.section-head{
  display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;
}
.section-title{
  font-family:'Barlow Condensed',sans-serif;
  font-size:20px;font-weight:700;color:var(--white);letter-spacing:0.3px;
  display:flex;align-items:center;gap:8px;
}
.section-badge{
  font-size:10px;color:var(--green);background:rgba(57,255,122,0.1);
  border:1px solid rgba(57,255,122,0.2);
  padding:2px 8px;border-radius:10px;font-weight:700;letter-spacing:0.5px;
}
.section-sub{font-size:11px;color:var(--dim)}
.refresh-btn{
  display:flex;align-items:center;gap:5px;
  font-size:12px;color:var(--dim);
  background:var(--surface2);border:1px solid rgba(255,255,255,0.07);
  border-radius:20px;padding:5px 10px;cursor:pointer;transition:.2s;
}
.refresh-btn:hover{color:var(--green);border-color:rgba(57,255,122,0.3)}
.spin{animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}

/* â”€â”€ LOADING SKELETON â”€â”€ */
.skeleton-wrap{display:flex;flex-direction:column;gap:10px}
.skeleton{
  background:linear-gradient(90deg,var(--surface) 25%,var(--surface2) 50%,var(--surface) 75%);
  background-size:200% 100%;
  animation:shimmer 1.5s infinite;
  border-radius:var(--radius);
  border:1px solid var(--border);
}
@keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}

/* â”€â”€ EVENT CARD â”€â”€ */
.events-list{display:flex;flex-direction:column;gap:10px}
.event-card{
  background:var(--surface);border:1px solid var(--border);
  border-radius:var(--radius);overflow:hidden;
  cursor:pointer;transition:.2s var(--ease);
  animation:fadeUp .35s ease forwards;opacity:0;
}
@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.event-card:hover{border-color:rgba(57,255,122,0.35);transform:translateY(-2px);box-shadow:0 8px 30px rgba(0,0,0,0.3)}
.event-card-inner{display:flex;gap:0}
.event-date-block{
  width:64px;flex-shrink:0;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  padding:14px 8px;
  border-right:1px solid var(--border);
}
.event-month{font-size:10px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:var(--dim)}
.event-day{font-family:'Barlow Condensed',sans-serif;font-size:30px;font-weight:900;color:var(--white);line-height:1}
.event-dow{font-size:10px;color:var(--dim)}
.event-main{flex:1;padding:12px 14px;min-width:0}
.event-name{
  font-family:'Barlow Condensed',sans-serif;
  font-size:17px;font-weight:700;color:var(--white);
  line-height:1.2;margin-bottom:5px;
  display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;
}
.event-meta{display:flex;flex-wrap:wrap;gap:6px;align-items:center}
.event-venue{font-size:12px;color:var(--dim);display:flex;align-items:center;gap:3px}
.event-cat{
  font-size:10px;font-weight:700;padding:2px 7px;border-radius:4px;
  text-transform:uppercase;letter-spacing:0.5px;
}
.cat-music{background:rgba(155,114,255,0.15);color:var(--purple)}
.cat-sports{background:rgba(57,255,122,0.12);color:var(--green)}
.cat-mma{background:rgba(255,68,85,0.15);color:var(--red)}
.cat-arts{background:rgba(255,183,3,0.12);color:var(--amber)}
.cat-family{background:rgba(0,194,224,0.12);color:var(--blue)}
.cat-other{background:rgba(255,255,255,0.08);color:var(--dim)}
.event-price{
  font-size:11px;color:var(--green);font-weight:600;
  background:rgba(57,255,122,0.08);border:1px solid rgba(57,255,122,0.15);
  padding:2px 7px;border-radius:4px;
}
.event-arrow{
  display:flex;align-items:center;padding:0 12px;
  color:var(--dim);font-size:18px;transition:.2s;
}
.event-card:hover .event-arrow{color:var(--green);transform:translateX(2px)}

/* â”€â”€ FILTER TABS â”€â”€ */
.filter-row{
  display:flex;gap:7px;overflow-x:auto;scrollbar-width:none;
  padding:0 16px 16px;
}
.filter-row::-webkit-scrollbar{display:none}
.filt-btn{
  display:flex;align-items:center;gap:5px;
  white-space:nowrap;padding:7px 13px;border-radius:50px;
  border:1px solid var(--border);background:var(--surface);
  color:var(--dim);font-family:'Barlow',sans-serif;font-size:12px;font-weight:500;
  cursor:pointer;transition:.15s;flex-shrink:0;
}
.filt-btn.active{background:var(--green);border-color:var(--green);color:var(--dark);font-weight:700}
.filt-btn:hover:not(.active){border-color:rgba(57,255,122,0.3);color:var(--text)}

/* â”€â”€ STATIC ACTIVITY CARDS â”€â”€ */
.activity-card{
  background:var(--surface);border:1px solid var(--border);
  border-radius:var(--radius);cursor:pointer;
  transition:.2s var(--ease);overflow:hidden;
  animation:fadeUp .3s ease forwards;opacity:0;
}
.activity-card:hover{border-color:rgba(57,255,122,0.35);transform:translateY(-2px);box-shadow:0 8px 25px rgba(0,0,0,0.3)}
.ac-top{display:flex;align-items:center;gap:12px;padding:14px}
.ac-emoji{
  width:48px;height:48px;border-radius:10px;
  display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0;
}
.ac-info{flex:1;min-width:0}
.ac-name{
  font-family:'Barlow Condensed',sans-serif;font-size:17px;font-weight:700;color:var(--white);
  line-height:1.2;
}
.ac-meta{display:flex;flex-wrap:wrap;gap:6px;margin-top:4px;align-items:center}
.ac-dist{font-size:11px;color:var(--dim)}
.ac-rating{font-size:11px;color:var(--amber);font-weight:600}
.badge-on{background:rgba(255,183,3,0.12);color:var(--amber);border:1px solid rgba(255,183,3,0.25);font-size:10px;font-weight:700;padding:2px 7px;border-radius:4px;text-transform:uppercase}
.badge-off{background:rgba(0,194,224,0.1);color:var(--blue);border:1px solid rgba(0,194,224,0.2);font-size:10px;font-weight:700;padding:2px 7px;border-radius:4px;text-transform:uppercase}
.ac-preview{padding:0 14px 10px;font-size:12px;color:var(--dim);line-height:1.5;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.ac-tags{display:flex;gap:5px;padding:0 14px 12px;flex-wrap:wrap}
.tag{font-size:10px;color:var(--dim);background:var(--surface2);border:1px solid rgba(255,255,255,0.06);padding:3px 7px;border-radius:4px}
.ac-chevron{padding:0 14px;font-size:18px;color:var(--dim);transition:.2s}
.activity-card:hover .ac-chevron{color:var(--green);transform:translateX(3px)}

/* â”€â”€ HUNTING / WDFW CARDS â”€â”€ */
.wdfw-card{
  background:var(--surface);border:1px solid var(--border);
  border-radius:var(--radius);padding:16px;margin-bottom:10px;
}
.wdfw-header{display:flex;align-items:center;gap:12px;margin-bottom:10px}
.wdfw-icon{font-size:28px}
.wdfw-title{font-family:'Barlow Condensed',sans-serif;font-size:18px;font-weight:700;color:var(--white)}
.wdfw-sub{font-size:12px;color:var(--dim)}
.season-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.season-item{
  background:var(--surface2);border-radius:8px;padding:10px;
  border:1px solid rgba(255,255,255,0.06);
}
.season-animal{font-size:11px;font-weight:700;color:var(--text);text-transform:uppercase;letter-spacing:0.5px}
.season-dates{font-size:12px;color:var(--amber);font-weight:600;margin-top:2px}
.season-notes{font-size:11px;color:var(--dim);margin-top:2px}
.wdfw-link{
  display:flex;align-items:center;justify-content:space-between;
  margin-top:12px;padding:10px 14px;
  background:rgba(57,255,122,0.06);border:1px solid rgba(57,255,122,0.15);
  border-radius:8px;text-decoration:none;cursor:pointer;transition:.2s;
}
.wdfw-link:hover{background:rgba(57,255,122,0.1);border-color:rgba(57,255,122,0.3)}
.wdfw-link-text{font-size:13px;color:var(--green);font-weight:600}
.wdfw-link-arrow{color:var(--green)}

/* â”€â”€ RESOURCES â”€â”€ */
.resources-grid{
  display:grid;grid-template-columns:1fr 1fr;gap:10px;
  padding:0 16px 16px;max-width:800px;margin:0 auto;
}
.res-card{
  background:var(--surface);border:1px solid var(--border);
  border-radius:var(--radius);padding:14px;
  text-decoration:none;cursor:pointer;transition:.2s;
  display:block;
}
.res-card:hover{border-color:rgba(57,255,122,0.35);transform:translateY(-2px)}
.res-emoji{font-size:26px;margin-bottom:8px}
.res-name{font-family:'Barlow Condensed',sans-serif;font-size:15px;font-weight:700;color:var(--white);margin-bottom:3px}
.res-sub{font-size:11px;color:var(--dim);line-height:1.4}

/* â”€â”€ MODAL â”€â”€ */
.modal-overlay{
  position:fixed;inset:0;z-index:300;
  background:rgba(0,0,0,0.8);backdrop-filter:blur(10px);
  display:flex;align-items:flex-end;
  opacity:0;pointer-events:none;transition:opacity .25s ease;
}
.modal-overlay.open{opacity:1;pointer-events:all}
.modal{
  width:100%;max-width:800px;margin:0 auto;
  background:var(--surface);
  border-radius:20px 20px 0 0;
  border-top:1px solid var(--border);
  border-left:1px solid var(--border);
  border-right:1px solid var(--border);
  max-height:88vh;overflow-y:auto;
  transform:translateY(100%);transition:transform .3s var(--ease);
}
.modal-overlay.open .modal{transform:translateY(0)}
.modal-handle{width:36px;height:4px;background:rgba(255,255,255,0.12);border-radius:2px;margin:10px auto 0}
.modal-head{display:flex;align-items:center;gap:14px;padding:18px 18px 0}
.modal-emoji{width:60px;height:60px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:28px;flex-shrink:0}
.modal-title{font-family:'Barlow Condensed',sans-serif;font-size:24px;font-weight:900;color:var(--white);line-height:1.1}
.modal-subtitle{font-size:12px;color:var(--green);font-weight:600;margin-top:3px}
.modal-close{width:34px;height:34px;border-radius:50%;background:var(--surface2);border:none;color:var(--dim);font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;align-self:flex-start;flex-shrink:0;transition:.15s}
.modal-close:hover{color:var(--white)}
.modal-body{padding:18px}
.m-section{font-family:'Barlow Condensed',sans-serif;font-size:12px;font-weight:700;color:var(--dim);letter-spacing:1.5px;text-transform:uppercase;margin-bottom:6px;margin-top:16px}
.m-section:first-child{margin-top:0}
.m-text{font-size:14px;color:var(--text);line-height:1.65}
.m-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:4px}
.m-pill{background:var(--surface2);border:1px solid rgba(255,255,255,0.07);border-radius:8px;padding:10px}
.m-pill .lbl{font-size:9px;text-transform:uppercase;letter-spacing:1px;color:var(--dim);font-weight:600}
.m-pill .val{font-size:13px;font-weight:600;color:var(--white);margin-top:3px}
.m-pill .val.g{color:var(--green)}
.m-pill .val.a{color:var(--amber)}
.m-pill .val.b{color:var(--blue)}
.m-tags{display:flex;flex-wrap:wrap;gap:5px;margin-top:6px}
.m-tag{font-size:11px;color:var(--text);background:var(--surface3);border:1px solid rgba(255,255,255,0.07);padding:4px 9px;border-radius:5px}
.m-links{display:flex;flex-direction:column;gap:7px;margin-top:4px}
.m-link{
  display:flex;align-items:center;justify-content:space-between;
  background:var(--surface2);border:1px solid rgba(255,255,255,0.07);
  border-radius:9px;padding:12px 14px;
  text-decoration:none;color:var(--text);font-size:13px;font-weight:500;
  transition:.15s;cursor:pointer;
}
.m-link:hover{border-color:rgba(57,255,122,0.3);color:var(--green)}

/* â”€â”€ SEARCH â”€â”€ */
.search-wrap{position:relative;margin:0 16px 14px;max-width:800px;}
.search-icon{position:absolute;left:14px;top:50%;transform:translateY(-50%);font-size:15px;color:var(--dim)}
.search-input{
  width:100%;background:var(--surface2);border:1px solid var(--border);
  border-radius:50px;padding:11px 16px 11px 40px;
  color:var(--text);font-family:'Barlow',sans-serif;font-size:14px;outline:none;transition:.2s;
}
.search-input::placeholder{color:var(--dim)}
.search-input:focus{border-color:rgba(57,255,122,0.4);background:var(--surface3)}

/* â”€â”€ EMPTY â”€â”€ */
.empty{text-align:center;padding:40px 16px;color:var(--dim)}
.empty-icon{font-size:44px;margin-bottom:10px}
.empty-title{font-family:'Barlow Condensed',sans-serif;font-size:20px;font-weight:700;color:var(--text);margin-bottom:5px}

/* â”€â”€ TIPS â”€â”€ */
.tips-list{display:flex;flex-direction:column;gap:10px;padding:0 16px;max-width:800px;margin:0 auto}
.tip{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:16px}
.tip-num{font-family:'Barlow Condensed',sans-serif;font-size:32px;font-weight:900;color:rgba(57,255,122,0.15);line-height:1;margin-bottom:4px}
.tip-title{font-family:'Barlow Condensed',sans-serif;font-size:18px;font-weight:700;color:var(--white);margin-bottom:6px}
.tip-body{font-size:13px;color:var(--dim);line-height:1.6}

/* â”€â”€ INSTALL CARD â”€â”€ */
.install-card{
  margin:16px;background:linear-gradient(135deg,rgba(26,58,42,0.7),rgba(10,22,40,0.7));
  border:1px solid rgba(57,255,122,0.25);border-radius:var(--radius);padding:16px;
  max-width:800px;
}
.install-title{font-family:'Barlow Condensed',sans-serif;font-size:18px;font-weight:700;color:var(--green);margin-bottom:6px}
.install-body{font-size:12px;color:var(--dim);line-height:1.7}
.install-body strong{color:var(--text)}

/* â”€â”€ ERROR TOAST â”€â”€ */
.toast{
  position:fixed;top:70px;left:50%;transform:translateX(-50%) translateY(-20px);
  background:rgba(255,68,85,0.9);color:white;
  padding:10px 18px;border-radius:20px;
  font-size:13px;font-weight:600;z-index:400;
  opacity:0;transition:.3s;pointer-events:none;
  white-space:nowrap;
}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

/* â”€â”€ ANIM DELAYS â”€â”€ */
.activity-card:nth-child(1){animation-delay:.03s}
.activity-card:nth-child(2){animation-delay:.07s}
.activity-card:nth-child(3){animation-delay:.11s}
.activity-card:nth-child(4){animation-delay:.15s}
.activity-card:nth-child(5){animation-delay:.19s}
.activity-card:nth-child(6){animation-delay:.23s}
.event-card:nth-child(1){animation-delay:.04s}
.event-card:nth-child(2){animation-delay:.08s}
.event-card:nth-child(3){animation-delay:.12s}
.event-card:nth-child(4){animation-delay:.16s}
.event-card:nth-child(5){animation-delay:.20s}
</style>
</head>
<body>

<!-- â•â•â• SETUP SCREEN â•â•â• -->
<div id="setupScreen">
  <div class="setup-card">
    <div class="setup-icon">ğŸ–ï¸</div>
    <div class="setup-title">JBLM Scout Setup</div>
    <div class="setup-sub">One-time setup takes 3 minutes. After this, the app updates itself automatically with live concerts, events, and more â€” forever.</div>

    <div class="setup-steps">
      <div class="setup-step">
        <div class="step-num">1</div>
        <div class="step-text">Go to <a href="https://developer.ticketmaster.com/products-and-docs/apis/getting-started/" target="_blank"><strong>developer.ticketmaster.com</strong></a> and create a free account</div>
      </div>
      <div class="setup-step">
        <div class="step-num">2</div>
        <div class="step-text">After signing up, your <strong>API Key</strong> appears on your account dashboard â€” it's a long string of letters and numbers</div>
      </div>
      <div class="setup-step">
        <div class="step-num">3</div>
        <div class="step-text">Copy and paste it below. This is stored only on this device and never shared.</div>
      </div>
    </div>

    <div class="api-input-wrap">
      <input class="api-input" id="apiKeyInput" type="text" placeholder="Paste your Ticketmaster API key here..." autocomplete="off" spellcheck="false">
    </div>
    <div class="setup-error" id="setupError">âš ï¸ Invalid API key â€” please check and try again</div>
    <button class="btn-primary" id="setupBtn" onclick="handleSetup()">ğŸš€ Launch JBLM Scout</button>
    <button class="btn-secondary" onclick="skipSetup()">Skip for now (demo mode â€” no live events)</button>
  </div>
</div>

<!-- â•â•â• TOAST â•â•â• -->
<div class="toast" id="toast"></div>

<!-- â•â•â• MAIN APP â•â•â• -->
<div id="mainApp" style="display:none">

<!-- HEADER -->
<header class="app-header">
  <div class="header-inner">
    <div class="logo">
      <div class="logo-icon">ğŸ–ï¸</div>
      <div>
        <span class="logo-name">JBLM SCOUT</span>
        <span class="logo-tag">Pacific Northwest</span>
      </div>
    </div>
    <div class="live-badge" onclick="refreshAll()" title="Tap to refresh live data">
      <span class="live-dot"></span>
      <span id="liveStatus">LIVE</span>
    </div>
  </div>
</header>

<!-- â•â•â• VIEW: EVENTS (Live) â•â•â• -->
<div class="view active" id="view-events">
  <div style="padding:20px 16px 16px;max-width:800px;margin:0 auto">
    <div class="hero-eyebrow">ğŸŸï¸ Auto-Updating â€¢ Live Data</div>
    <h1 style="font-family:'Barlow Condensed',sans-serif;font-size:32px;font-weight:900;color:var(--white);margin-bottom:4px">Upcoming <em style="color:var(--green);font-style:normal">Events</em></h1>
    <p style="font-size:13px;color:var(--dim)">Concerts, sports, MMA, tournaments & more â€” updated live near JBLM</p>
  </div>

  <!-- Filter row -->
  <div class="filter-row" id="eventFilters">
    <button class="filt-btn active" data-seg="all">âš¡ All</button>
    <button class="filt-btn" data-seg="music">ğŸµ Concerts</button>
    <button class="filt-btn" data-seg="sports">ğŸ… Sports</button>
    <button class="filt-btn" data-seg="arts">ğŸ­ Arts & Shows</button>
    <button class="filt-btn" data-seg="family">ğŸ‘ª Family</button>
    <button class="filt-btn" data-seg="misc">ğŸª Misc</button>
  </div>

  <div class="section" style="padding-top:0">
    <div class="section-head">
      <div class="section-title" id="eventsTitle">All Events <span class="section-badge" id="eventsCount">Loading...</span></div>
      <button class="refresh-btn" onclick="loadEvents()"><span id="refreshIcon">â†»</span> Refresh</button>
    </div>
    <div id="eventsContainer"></div>
  </div>
</div>

<!-- â•â•â• VIEW: EXPLORE (Static + Curated) â•â•â• -->
<div class="view" id="view-explore">
  <div style="padding:20px 16px 14px;max-width:800px;margin:0 auto">
    <div class="hero-eyebrow">ğŸŒ² JBLM + 50 Mile Radius</div>
    <h1 style="font-family:'Barlow Condensed',sans-serif;font-size:32px;font-weight:900;color:var(--white);margin-bottom:4px">Places & <em style="color:var(--green);font-style:normal">Activities</em></h1>
    <p style="font-size:13px;color:var(--dim)">MMA gyms, sports leagues, D&D, hunting, outdoor adventures and more</p>
  </div>

  <div class="search-wrap">
    <span class="search-icon">ğŸ”</span>
    <input class="search-input" id="searchInput" type="text" placeholder="Search gyms, sports, D&D, hunting..." autocomplete="off">
  </div>

  <div class="filter-row" id="exploreFilters">
    <button class="filt-btn active" data-cat="all">âš¡ All</button>
    <button class="filt-btn" data-cat="onbase">ğŸ–ï¸ On Base</button>
    <button class="filt-btn" data-cat="mma">ğŸ¥Š MMA & Martial Arts</button>
    <button class="filt-btn" data-cat="sports">ğŸ… Leagues</button>
    <button class="filt-btn" data-cat="outdoor">ğŸŒ² Outdoor & Hunting</button>
    <button class="filt-btn" data-cat="gaming">ğŸ² D&D & Gaming</button>
    <button class="filt-btn" data-cat="nature">â›°ï¸ Hiking</button>
    <button class="filt-btn" data-cat="social">ğŸº Social</button>
  </div>

  <div class="section" style="padding-top:0">
    <div class="section-head">
      <div class="section-title" id="exploreTitle">All Activities <span class="section-badge" id="exploreCount"></span></div>
    </div>
    <div id="exploreContainer" style="display:flex;flex-direction:column;gap:10px"></div>
  </div>
</div>

<!-- â•â•â• VIEW: HUNTING / WDFW â•â•â• -->
<div class="view" id="view-hunting">
  <div style="padding:20px 16px 16px;max-width:800px;margin:0 auto">
    <div class="hero-eyebrow">ğŸ¦Œ Live WDFW Data</div>
    <h1 style="font-family:'Barlow Condensed',sans-serif;font-size:32px;font-weight:900;color:var(--white);margin-bottom:4px">Hunting & <em style="color:var(--green);font-style:normal">Fishing</em></h1>
    <p style="font-size:13px;color:var(--dim)">Washington DFW seasons, licenses & regulations for the JBLM area</p>
  </div>

  <div style="padding:0 16px;max-width:800px;margin:0 auto">

    <div class="wdfw-card">
      <div class="wdfw-header">
        <div class="wdfw-icon">ğŸ¦Œ</div>
        <div>
          <div class="wdfw-title">Big Game Hunting Seasons</div>
          <div class="wdfw-sub">Pierce & Thurston County â€” GMUs near JBLM</div>
        </div>
      </div>
      <div class="season-grid">
        <div class="season-item">
          <div class="season-animal">ğŸ¦Œ Deer (Archery)</div>
          <div class="season-dates">Sep 1 â€“ Nov 15</div>
          <div class="season-notes">GMUs 652, 654, 666</div>
        </div>
        <div class="season-item">
          <div class="season-animal">ğŸ¦Œ Deer (Rifle)</div>
          <div class="season-dates">Oct 12 â€“ Nov 15</div>
          <div class="season-notes">General Season</div>
        </div>
        <div class="season-item">
          <div class="season-animal">ğŸ« Elk (Archery)</div>
          <div class="season-dates">Sep 6 â€“ Sep 21</div>
          <div class="season-notes">By permit draw</div>
        </div>
        <div class="season-item">
          <div class="season-animal">ğŸ« Elk (Rifle)</div>
          <div class="season-dates">Oct 26 â€“ Nov 8</div>
          <div class="season-notes">Limited entry</div>
        </div>
        <div class="season-item">
          <div class="season-animal">ğŸ¦ƒ Turkey (Spring)</div>
          <div class="season-dates">Apr 15 â€“ May 31</div>
          <div class="season-notes">SW WA units</div>
        </div>
        <div class="season-item">
          <div class="season-animal">ğŸ¦† Waterfowl</div>
          <div class="season-dates">Oct â€“ Jan</div>
          <div class="season-notes">Nisqually Wildlife Refuge</div>
        </div>
      </div>
      <a class="wdfw-link" href="https://wdfw.wa.gov/hunting/seasons" target="_blank">
        <span class="wdfw-link-text">ğŸ“… View Full Season Dates on WDFW.wa.gov</span>
        <span class="wdfw-link-arrow">â†—</span>
      </a>
    </div>

    <div class="wdfw-card">
      <div class="wdfw-header">
        <div class="wdfw-icon">ğŸ£</div>
        <div>
          <div class="wdfw-title">Fishing â€” Puget Sound & Rivers</div>
          <div class="wdfw-sub">Salmon, steelhead, trout, crabbing</div>
        </div>
      </div>
      <div class="season-grid">
        <div class="season-item">
          <div class="season-animal">ğŸŸ Chinook Salmon</div>
          <div class="season-dates">Aug â€“ Oct</div>
          <div class="season-notes">Puget Sound runs</div>
        </div>
        <div class="season-item">
          <div class="season-animal">ğŸŸ Coho Salmon</div>
          <div class="season-dates">Sep â€“ Nov</div>
          <div class="season-notes">Puyallup & Nisqually</div>
        </div>
        <div class="season-item">
          <div class="season-animal">ğŸŸ Steelhead</div>
          <div class="season-dates">Nov â€“ Mar</div>
          <div class="season-notes">Nisqually River</div>
        </div>
        <div class="season-item">
          <div class="season-animal">ğŸ¦€ Dungeness Crab</div>
          <div class="season-dates">Jul â€“ Sep</div>
          <div class="season-notes">Puget Sound zones</div>
        </div>
        <div class="season-item">
          <div class="season-animal">ğŸŸ Trout / Bass</div>
          <div class="season-dates">Year-round</div>
          <div class="season-notes">Steilacoom Lake</div>
        </div>
        <div class="season-item">
          <div class="season-animal">ğŸ¦‘ Squid / Bottomfish</div>
          <div class="season-dates">Year-round</div>
          <div class="season-notes">Puget Sound piers</div>
        </div>
      </div>
      <a class="wdfw-link" href="https://wdfw.wa.gov/fishing/regulations" target="_blank">
        <span class="wdfw-link-text">ğŸ“‹ WDFW Fishing Regulations & Reports</span>
        <span class="wdfw-link-arrow">â†—</span>
      </a>
    </div>

    <div class="wdfw-card">
      <div class="wdfw-header">
        <div class="wdfw-icon">ğŸ“‹</div>
        <div>
          <div class="wdfw-title">Licenses & Key Links</div>
          <div class="wdfw-sub">Everything you need to be legal in WA</div>
        </div>
      </div>
      <div style="display:flex;flex-direction:column;gap:7px">
        <a class="wdfw-link" href="https://wdfw.wa.gov/licenses/hunting" target="_blank">
          <span class="wdfw-link-text">ğŸ« Buy Hunting License (WDFW)</span>
          <span class="wdfw-link-arrow">â†—</span>
        </a>
        <a class="wdfw-link" href="https://wdfw.wa.gov/licenses/fishing" target="_blank">
          <span class="wdfw-link-text">ğŸ« Buy Fishing License (WDFW)</span>
          <span class="wdfw-link-arrow">â†—</span>
        </a>
        <a class="wdfw-link" href="https://wdfw.wa.gov/hunting/draw" target="_blank">
          <span class="wdfw-link-text">ğŸ¯ Special Draw Permits (Elk, etc.)</span>
          <span class="wdfw-link-arrow">â†—</span>
        </a>
        <a class="wdfw-link" href="https://wdfw.wa.gov/hunting/regulations/game-management-units" target="_blank">
          <span class="wdfw-link-text">ğŸ—ºï¸ Game Management Unit Map</span>
          <span class="wdfw-link-arrow">â†—</span>
        </a>
        <a class="wdfw-link" href="https://wdfw.wa.gov/fishing/puget-sound" target="_blank">
          <span class="wdfw-link-text">ğŸŒŠ Puget Sound Fishing Reports</span>
          <span class="wdfw-link-arrow">â†—</span>
        </a>
      </div>
    </div>

  </div>
</div>

<!-- â•â•â• VIEW: RESOURCES â•â•â• -->
<div class="view" id="view-resources">
  <div style="padding:20px 16px 14px;max-width:800px;margin:0 auto">
    <div class="hero-eyebrow">ğŸ–ï¸ JBLM & PNW Links</div>
    <h1 style="font-family:'Barlow Condensed',sans-serif;font-size:32px;font-weight:900;color:var(--white);margin-bottom:4px">Resources & <em style="color:var(--green);font-style:normal">Tips</em></h1>
    <p style="font-size:13px;color:var(--dim)">Official base links, soldier tips, and how to install this app</p>
  </div>

  <div class="resources-grid" id="resourcesGrid"></div>

  <div style="padding:4px 16px 16px;max-width:800px;margin:0 auto">
    <div class="install-card">
      <div class="install-title">ğŸ“² Install as a Real App</div>
      <div class="install-body">
        <strong>iPhone:</strong> Open in Safari â†’ tap Share â†’ "Add to Home Screen"<br>
        <strong>Android:</strong> Open in Chrome â†’ tap â‹® â†’ "Add to Home Screen"<br><br>
        Works offline for the Explore, Hunting and Resources tabs. Live events load when connected.
      </div>
    </div>

    <div style="margin-top:12px">
      <div style="font-family:'Barlow Condensed',sans-serif;font-size:20px;font-weight:700;color:var(--white);margin-bottom:12px">ğŸ’¡ New Soldier Tips</div>
      <div class="tips-list" style="padding:0">
        <div class="tip"><div class="tip-num">01</div><div class="tip-title">National Parks = FREE with Military ID</div><div class="tip-body">Every active duty soldier gets free access to all US National Parks. Mt. Rainier and Olympic NP are both within 90 minutes of JBLM.</div></div>
        <div class="tip"><div class="tip-num">02</div><div class="tip-title">Use MWR Before Paying Full Price Anywhere</div><div class="tip-body">JBLM MWR has heavily discounted golf, bowling, kayak rentals, paintball gear, camping equipment, and event tickets. Check jblmfmwr.com first.</div></div>
        <div class="tip"><div class="tip-num">03</div><div class="tip-title">Lacrosse â€” Reach Out Immediately</div><div class="tip-body">253 Lacrosse is the local club. Contact them the week you arrive â€” don't wait for a season to start. The PNW lacrosse scene is active and growing.</div></div>
        <div class="tip"><div class="tip-num">04</div><div class="tip-title">Elk Draw Permits Fill Fast</div><div class="tip-body">Apply for WA elk draw permits at WDFW.wa.gov as soon as you arrive. Popular units (652, 654) are oversubscribed â€” the earlier you apply, the better.</div></div>
        <div class="tip"><div class="tip-num">05</div><div class="tip-title">TerraCrux = Your D&D Home Base</div><div class="tip-body">Show up Thursday or Friday evening to TerraCrux Games in Tacoma. Open game nights are the fastest way to meet the local D&D community without needing a pre-formed group.</div></div>
        <div class="tip"><div class="tip-num">06</div><div class="tip-title">Seattle is 45 Minutes Away</div><div class="tip-body">World-class concerts at Climate Pledge Arena, Seahawks games, Pike Place Market, and one of the best food scenes in the country. Don't limit yourself to Tacoma.</div></div>
        <div class="tip"><div class="tip-num">07</div><div class="tip-title">Get Rain Gear â€” Don't Let It Stop You</div><div class="tip-body">Western WA gets heavy rain Octâ€“May. Invest in quality waterproof gear and the outdoors stays 100% accessible year-round. Big J's in Orting is the best local shop.</div></div>
        <div class="tip"><div class="tip-num">08</div><div class="tip-title">JBLM Combatives = Free BJJ + Army Credit</div><div class="tip-body">Train Army Combatives (MACP) on base for free and earn Level 1â€“4 certifications. Then supplement with one of the elite civilian MMA gyms nearby for rapid skill growth.</div></div>
      </div>
    </div>

    <div style="margin-top:16px;text-align:center;padding:16px 0">
      <button onclick="showSetup()" style="background:none;border:1px solid var(--border);color:var(--dim);padding:10px 20px;border-radius:20px;font-size:12px;cursor:pointer;transition:.2s" onmouseover="this.style.color='var(--text)'" onmouseout="this.style.color='var(--dim)'">âš™ï¸ Update API Key</button>
    </div>
  </div>
</div>

</div><!-- end mainApp -->

<!-- MODAL -->
<div class="modal-overlay" id="modalOverlay">
  <div class="modal" id="modalContent">
    <div class="modal-handle"></div>
    <div class="modal-head">
      <div class="modal-emoji" id="mEmoji"></div>
      <div style="flex:1">
        <div class="modal-title" id="mTitle"></div>
        <div class="modal-subtitle" id="mSubtitle"></div>
      </div>
      <button class="modal-close" onclick="closeModal()">âœ•</button>
    </div>
    <div class="modal-body" id="mBody"></div>
  </div>
</div>

<!-- NAV BAR -->
<nav class="nav-bar" id="navBar" style="display:none">
  <button class="nav-btn active" onclick="switchView('events',this)">
    <span class="nav-icon">ğŸŸï¸</span><span class="nav-label">Events</span>
  </button>
  <button class="nav-btn" onclick="switchView('explore',this)">
    <span class="nav-icon">âš¡</span><span class="nav-label">Explore</span>
  </button>
  <button class="nav-btn" onclick="switchView('hunting',this)">
    <span class="nav-icon">ğŸ¦Œ</span><span class="nav-label">Hunting</span>
  </button>
  <button class="nav-btn" onclick="switchView('resources',this)">
    <span class="nav-icon">ğŸ–ï¸</span><span class="nav-label">Resources</span>
  </button>
</nav>

<script>
// â•â•â• CONFIG â•â•â•
const JBLM_LAT = 47.1123;
const JBLM_LNG = -122.5756;
const RADIUS_MILES = 50;
const TM_BASE = 'https://app.ticketmaster.com/discovery/v2/events.json';

// â•â•â• STATE â•â•â•
let apiKey = localStorage.getItem('jblm_tm_key') || '';
let allEvents = [];
let currentEventSeg = 'all';
let currentExploreCat = 'all';
let searchQuery = '';

// â•â•â• SETUP â•â•â•
function init() {
  if (apiKey) {
    launchApp();
  } else {
    document.getElementById('setupScreen').style.display = 'flex';
  }
}

async function handleSetup() {
  const key = document.getElementById('apiKeyInput').value.trim();
  if (!key || key.length < 10) {
    showSetupError('Please enter a valid API key');
    return;
  }
  const btn = document.getElementById('setupBtn');
  btn.textContent = 'â³ Verifying...';
  btn.disabled = true;

  // Test the key
  try {
    const res = await fetch(`${TM_BASE}?apikey=${key}&latlong=${JBLM_LAT},${JBLM_LNG}&radius=10&unit=miles&size=1`);
    const data = await res.json();
    if (data.fault || res.status === 401) {
      showSetupError('Invalid API key â€” please check and try again');
      btn.textContent = 'ğŸš€ Launch JBLM Scout';
      btn.disabled = false;
      return;
    }
    apiKey = key;
    localStorage.setItem('jblm_tm_key', key);
    launchApp();
  } catch(e) {
    showSetupError('Could not connect â€” check your internet connection');
    btn.textContent = 'ğŸš€ Launch JBLM Scout';
    btn.disabled = false;
  }
}

function skipSetup() {
  apiKey = '';
  launchApp();
}

function showSetupError(msg) {
  const el = document.getElementById('setupError');
  el.textContent = 'âš ï¸ ' + msg;
  el.style.display = 'block';
}

function showSetup() {
  document.getElementById('setupScreen').style.display = 'flex';
  document.getElementById('mainApp').style.display = 'none';
  document.getElementById('navBar').style.display = 'none';
}

function launchApp() {
  document.getElementById('setupScreen').style.display = 'none';
  document.getElementById('mainApp').style.display = 'block';
  document.getElementById('navBar').style.display = 'flex';
  renderExplore();
  renderResources();
  loadEvents();
}

// â•â•â• LIVE EVENTS â€” TICKETMASTER API â•â•â•
async function loadEvents() {
  if (!apiKey) {
    renderDemoEvents();
    return;
  }

  const container = document.getElementById('eventsContainer');
  const count = document.getElementById('eventsCount');
  const icon = document.getElementById('refreshIcon');

  container.innerHTML = buildSkeletons(5);
  count.textContent = 'Loading...';
  icon.classList.add('spin');

  try {
    // Fetch all categories in parallel
    const today = new Date().toISOString().split('T')[0] + 'T00:00:00Z';
    const future = new Date(Date.now() + 90*24*60*60*1000).toISOString().split('T')[0] + 'T00:00:00Z';

    const params = `apikey=${apiKey}&latlong=${JBLM_LAT},${JBLM_LNG}&radius=${RADIUS_MILES}&unit=miles&size=50&sort=date,asc&startDateTime=${today}&endDateTime=${future}`;

    const res = await fetch(`${TM_BASE}?${params}`);
    const data = await res.json();

    if (data.fault) throw new Error('API error');

    allEvents = (data._embedded?.events || []).map(parseEvent);
    renderEvents();
    updateLiveStatus();
    showToast('âœ… Events updated!');
  } catch(e) {
    container.innerHTML = `<div class="empty"><div class="empty-icon">ğŸ“¡</div><div class="empty-title">Couldn't load live events</div><p style="color:var(--dim);font-size:13px;margin-top:6px">Check your internet connection and tap Refresh</p></div>`;
    count.textContent = '0 found';
  } finally {
    icon.classList.remove('spin');
  }
}

function parseEvent(e) {
  const venue = e._embedded?.venues?.[0];
  const img = e.images?.find(i => i.ratio === '16_9' && i.width > 500);
  const seg = e.classifications?.[0]?.segment?.name?.toLowerCase() || 'other';
  const genre = e.classifications?.[0]?.genre?.name || '';
  const price = e.priceRanges?.[0];
  const dt = e.dates?.start;
  const dateStr = dt?.localDate || '';
  const timeStr = dt?.localTime || '';
  let d = null;
  if (dateStr) d = new Date(dateStr + 'T12:00:00');

  return {
    id: e.id,
    name: e.name,
    url: e.url,
    image: img?.url || '',
    venue: venue?.name || 'TBD',
    city: venue?.city?.name || 'Near JBLM',
    date: d,
    dateStr,
    timeStr,
    segment: mapSegment(seg, genre),
    genre,
    priceMin: price?.min,
    priceMax: price?.max,
    currency: price?.currency || 'USD',
  };
}

function mapSegment(seg, genre) {
  if (seg.includes('music')) return 'music';
  if (seg.includes('sport')) return 'sports';
  if (seg.includes('arts') || seg.includes('theatre')) return 'arts';
  if (seg.includes('family')) return 'family';
  return 'misc';
}

function renderEvents() {
  const container = document.getElementById('eventsContainer');
  const count = document.getElementById('eventsCount');

  let filtered = allEvents.filter(e => currentEventSeg === 'all' || e.segment === currentEventSeg);

  count.textContent = `${filtered.length} found`;

  if (filtered.length === 0) {
    container.innerHTML = apiKey
      ? `<div class="empty"><div class="empty-icon">ğŸŸï¸</div><div class="empty-title">No events found</div><p style="color:var(--dim);font-size:13px;margin-top:6px">Try a different category or check back soon</p></div>`
      : `<div class="empty"><div class="empty-icon">ğŸ”‘</div><div class="empty-title">API key needed for live events</div><p style="color:var(--dim);font-size:13px;margin-top:6px">Tap the âš™ï¸ button in Resources to add your free Ticketmaster key</p></div>`;
    return;
  }

  const segLabels = {music:'ğŸµ Concert',sports:'ğŸ… Sport',arts:'ğŸ­ Arts',family:'ğŸ‘ª Family',misc:'ğŸª Event'};

  container.innerHTML = '<div class="events-list">' + filtered.map((e,i) => {
    const mon = e.date ? e.date.toLocaleString('en-US',{month:'short'}).toUpperCase() : '---';
    const day = e.date ? e.date.getDate() : '--';
    const dow = e.date ? e.date.toLocaleString('en-US',{weekday:'short'}).toUpperCase() : '';
    const price = e.priceMin ? `From $${Math.round(e.priceMin)}` : 'Check Prices';
    return `
    <div class="event-card" onclick="openEventModal(${JSON.stringify(e).replace(/"/g,"&quot;")})" style="animation-delay:${i*0.04}s">
      <div class="event-card-inner">
        <div class="event-date-block">
          <div class="event-month">${mon}</div>
          <div class="event-day">${day}</div>
          <div class="event-dow">${dow}</div>
        </div>
        <div class="event-main">
          <div class="event-name">${e.name}</div>
          <div class="event-meta">
            <span class="event-venue">ğŸ“ ${e.venue}</span>
            <span class="event-cat cat-${e.segment}">${segLabels[e.segment]||'Event'}</span>
            <span class="event-price">${price}</span>
          </div>
        </div>
        <div class="event-arrow">â€º</div>
      </div>
    </div>`;
  }).join('') + '</div>';
}

function renderDemoEvents() {
  const container = document.getElementById('eventsContainer');
  document.getElementById('eventsCount').textContent = 'Demo mode';
  container.innerHTML = `<div class="empty"><div class="empty-icon">ğŸ”‘</div><div class="empty-title">Live events need an API key</div><p style="color:var(--dim);font-size:13px;margin-top:8px;line-height:1.6">Get a free key at <a href="https://developer.ticketmaster.com" target="_blank" style="color:var(--green)">developer.ticketmaster.com</a> and add it in the Resources tab â†’ "Update API Key"</p></div>`;
}

function openEventModal(eRaw) {
  const e = typeof eRaw === 'string' ? JSON.parse(eRaw.replace(/&quot;/g,'"')) : eRaw;
  const dateStr = e.date ? new Date(e.date).toLocaleDateString('en-US',{weekday:'long',month:'long',day:'numeric',year:'numeric'}) : 'Date TBD';
  const timeStr = e.timeStr ? formatTime(e.timeStr) : 'Time TBD';
  const price = e.priceMin ? `$${Math.round(e.priceMin)}${e.priceMax && e.priceMax !== e.priceMin ? ' â€“ $'+Math.round(e.priceMax) : ''}` : 'See website';
  const segMap = {music:'ğŸµ Concert',sports:'ğŸ… Sports Event',arts:'ğŸ­ Arts & Theatre',family:'ğŸ‘ª Family',misc:'ğŸª Event'};

  document.getElementById('mEmoji').textContent = {music:'ğŸµ',sports:'ğŸ…',arts:'ğŸ­',family:'ğŸ‘ª',misc:'ğŸª'}[e.segment] || 'ğŸŸï¸';
  document.getElementById('mEmoji').className = `modal-emoji cat-${e.segment}`;
  document.getElementById('mTitle').textContent = e.name;
  document.getElementById('mSubtitle').textContent = (segMap[e.segment] || 'Event') + ' â€¢ ' + e.city;
  document.getElementById('mBody').innerHTML = `
    <div class="m-grid">
      <div class="m-pill"><div class="lbl">Date</div><div class="val">${dateStr}</div></div>
      <div class="m-pill"><div class="lbl">Time</div><div class="val">${timeStr}</div></div>
      <div class="m-pill"><div class="lbl">Venue</div><div class="val">${e.venue}</div></div>
      <div class="m-pill"><div class="lbl">Price</div><div class="val g">${price}</div></div>
    </div>
    ${e.image ? `<img src="${e.image}" style="width:100%;border-radius:10px;margin:8px 0;object-fit:cover;max-height:180px" onerror="this.style.display='none'">` : ''}
    <div class="m-links">
      ${e.url ? `<a class="m-link" href="${e.url}" target="_blank"><span>ğŸŸï¸ Get Tickets on Ticketmaster</span><span>â†—</span></a>` : ''}
      <a class="m-link" href="https://maps.google.com/?q=${encodeURIComponent(e.venue + ' ' + e.city + ' WA')}" target="_blank"><span>ğŸ“ Get Directions to Venue</span><span>â†—</span></a>
    </div>
  `;
  document.getElementById('modalOverlay').classList.add('open');
  document.body.style.overflow = 'hidden';
}

function formatTime(t) {
  const [h,m] = t.split(':').map(Number);
  const ampm = h >= 12 ? 'PM' : 'AM';
  return `${h % 12 || 12}:${String(m).padStart(2,'0')} ${ampm}`;
}

// â•â•â• EVENT FILTERS â•â•â•
document.getElementById('eventFilters').addEventListener('click', e => {
  const btn = e.target.closest('.filt-btn');
  if (!btn) return;
  document.querySelectorAll('#eventFilters .filt-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  currentEventSeg = btn.dataset.seg;
  renderEvents();
});

// â•â•â• EXPLORE â€” STATIC DATA â•â•â•
const ACTIVITIES = [
  {id:1,name:"JBLM MWR Sports & Fitness",cat:"onbase",emoji:"ğŸ’ª",bg:"rgba(255,183,3,0.12)",badge:"on",loc:"Joint Base Lewis-McChord",dist:"On Base",cost:"Free / MWR",rating:4.5,tags:["MWR","Gym","Pools","Recreation","Free"],desc:"World-class MWR facilities including gyms, pools, sports courts, and dozens of rec programs â€” most free or deeply discounted for active duty. The single best resource a soldier at JBLM has access to.",hours:"Varies by facility",links:[{l:"ğŸŒ JBLM MWR",u:"https://www.jblmfmwr.com"},{l:"ğŸ“ Directions",u:"https://maps.google.com/?q=JBLM+WA"}]},
  {id:2,name:"JBLM Intramural Sports Leagues",cat:"onbase",emoji:"ğŸ†",bg:"rgba(255,183,3,0.12)",badge:"on",loc:"JBLM Athletic Fields",dist:"On Base",cost:"Free (MWR)",rating:4.4,tags:["Basketball","Flag Football","Soccer","Volleyball","Softball","MWR"],desc:"Year-round intramural and open leagues across multiple sports. Compete by unit or sign up solo. Basketball, flag football, soccer, volleyball, softball, and more. Best way to meet people and stay competitive without leaving base.",hours:"Evenings & Weekends",links:[{l:"ğŸŒ MWR Sports",u:"https://www.jblmfmwr.com/sports"},{l:"ğŸ“ Directions",u:"https://maps.google.com/?q=JBLM+Athletic+Fields+WA"}]},
  {id:3,name:"JBLM Army Combatives (Free BJJ)",cat:"onbase",emoji:"âš”ï¸",bg:"rgba(255,68,85,0.12)",badge:"on",loc:"JBLM Training Center",dist:"On Base",cost:"Free",rating:4.6,tags:["BJJ","MACP","Combatives","Certification","Free"],desc:"Army Combatives (MACP) training earns you Level 1â€“4 certifications â€” essentially Brazilian Jiu-Jitsu blended with wrestling. Free, on base, looks great on your record, and is an incredible supplement to any civilian gym.",links:[{l:"ğŸ“ JBLM Training Center",u:"https://maps.google.com/?q=JBLM+WA"}]},
  {id:4,name:"JBLM Golf (Eagle's Pride & Whispering Firs)",cat:"onbase",emoji:"â›³",bg:"rgba(255,183,3,0.12)",badge:"on",loc:"JBLM Golf Courses",dist:"On Base",cost:"$15â€“$35 military",rating:4.5,tags:["Golf","MWR","18-Hole"],desc:"Two beautiful 18-hole courses on base. Eagle's Pride is a full championship layout. Military green fees are among the lowest anywhere. Spectacular Pacific Northwest scenery.",hours:"Dawn to Dusk",links:[{l:"ğŸŒ Book Tee Times",u:"https://www.jblmfmwr.com/golf"}]},
  {id:5,name:"T-Town MMA / Checkmat Tacoma",cat:"mma",emoji:"ğŸ¥Š",bg:"rgba(255,68,85,0.12)",badge:"off",loc:"955 Tacoma Ave S",dist:"~8 miles",cost:"~$100â€“$140/mo",rating:4.9,tags:["BJJ","Kickboxing","MMA","Competition","Black Belt Instructors"],desc:"4.9â­ from 71 reviews. One of the best MMA gyms near JBLM. Brazilian Jiu-Jitsu under Checkmat affiliation, kickboxing, and MMA. Active competition team. Welcoming to all levels.",hours:"Mon/Wed: 11AMâ€“12:30PM & 5â€“8PM | Tue/Thu: 4:45â€“8PM | Fri: 5â€“8PM | Sat: 11AMâ€“2PM | Sun: 9â€“10:30AM",links:[{l:"ğŸŒ T-Town MMA",u:"https://ttownmma.com"},{l:"ğŸ“ Directions",u:"https://maps.google.com/?q=955+Tacoma+Ave+S+Tacoma+WA"}]},
  {id:6,name:"Vital Jiu-Jitsu / Srisuk Muay Thai",cat:"mma",emoji:"ğŸ¥‹",bg:"rgba(255,68,85,0.12)",badge:"off",loc:"2519 Pacific Hwy E, Fife",dist:"~6 miles",cost:"~$100â€“$130/mo",rating:4.9,tags:["BJJ","Muay Thai","Competition","Family Atmosphere","10+ Years"],desc:"4.9â­ from 75 reviews. A Tacoma institution for 10+ years. Members consistently call it their 'second family.' Top-notch BJJ and Muay Thai instruction for competitors and hobbyists alike.",hours:"Mon/Wed: 4:30â€“8:30PM | Tue/Thu: 5â€“8:30PM | Fri: 5:30â€“8:30PM | Sat: 10AMâ€“1PM | Sun: 1â€“3PM",links:[{l:"ğŸŒ Vital Jiu-Jitsu",u:"https://vitaljj.com"},{l:"ğŸ“ Directions",u:"https://maps.google.com/?q=2519+Pacific+Hwy+E+Fife+WA"}]},
  {id:7,name:"Wave Combat Sports",cat:"mma",emoji:"ğŸ´",bg:"rgba(255,68,85,0.12)",badge:"off",loc:"1720 S 7th St, Tacoma",dist:"~10 miles",cost:"~$100â€“$150/mo",rating:4.9,tags:["Kickboxing","Muay Thai","Boxing","Elite Striking","Structured"],desc:"4.9â­ from 90 reviews. Elite striking gym â€” every class described as 'paid seminar quality.' Coach Micah Brown's curriculum is methodically structured from fundamentals up. Spacious facility with central ring.",hours:"Monâ€“Fri: 12â€“8:30PM",links:[{l:"ğŸŒ Wave Combat",u:"https://www.wavecombatsports.com"},{l:"ğŸ“ Directions",u:"https://maps.google.com/?q=1720+S+7th+St+Tacoma+WA"}]},
  {id:8,name:"253 Lacrosse",cat:"sports",emoji:"ğŸ¥",bg:"rgba(57,255,122,0.1)",badge:"off",loc:"12180 Park Ave S, Tacoma",dist:"~5 miles",cost:"League fees vary",rating:4.5,tags:["Lacrosse","Adult Leagues","Tacoma","Competitive"],desc:"The primary adult lacrosse club in the Tacoma/South Pierce County area â€” JBLM's backyard. Adult recreational and competitive leagues. Contact them the week you arrive.",links:[{l:"ğŸŒ 253 Lacrosse",u:"https://www.253lacrosse.com"},{l:"ğŸ“ Directions",u:"https://maps.google.com/?q=12180+Park+Ave+S+Tacoma+WA"}]},
  {id:9,name:"Paul Bunyan Rifle & Sportsman's Club",cat:"outdoor",emoji:"ğŸ¯",bg:"rgba(0,194,224,0.1)",badge:"off",loc:"17902 Meridian E, South Hill",dist:"~12 miles",cost:"Membership + range fees",rating:4.4,tags:["Shooting","USPSA","IDPA","200-Yard Rifle","Archery","Competitions"],desc:"4.4â­ from 94 reviews. Full club with 200-yard rifle ranges, pistol, shotgun, action bays, and archery. Hosts USPSA and IDPA competitions. Members-only but absolutely worth it.",hours:"Daily 7AMâ€“10PM",links:[{l:"ğŸŒ Paul Bunyan Club",u:"https://www.paulbunyanclub.org"},{l:"ğŸ“ Directions",u:"https://maps.google.com/?q=Paul+Bunyan+Rifle+Club+South+Hill+WA"}]},
  {id:10,name:"TerraCrux Games â€” D&D & Tabletop",cat:"gaming",emoji:"ğŸ‰",bg:"rgba(255,183,3,0.1)",badge:"off",loc:"760 Commerce St, Tacoma",dist:"~12 miles",cost:"Free to play / Retail",rating:4.7,tags:["D&D","Dungeons & Dragons","MTG","Warhammer","Organized Play","Minis"],desc:"4.7â­ from 645 reviews â€” described as 'D&D Valhalla.' Huge selection of sourcebooks, minis, and paints. Regular organized play nights including D&D Adventurers League. The most welcoming game store in Tacoma.",hours:"Monâ€“Wed: 12â€“8PM | Thuâ€“Fri: 12â€“10PM | Sat: 12â€“8PM | Sun: 12â€“7PM",links:[{l:"ğŸŒ TerraCrux",u:"https://www.terracruxgames.com"},{l:"ğŸ“ Directions",u:"https://maps.google.com/?q=TerraCrux+Games+760+Commerce+St+Tacoma"}]},
  {id:11,name:"Mt. Rainier National Park",cat:"nature",emoji:"â›°ï¸",bg:"rgba(57,255,122,0.08)",badge:"off",loc:"Paradise / Sunrise Visitor Center",dist:"~55 miles",cost:"FREE with Military ID",rating:4.9,tags:["Hiking","Backpacking","Snowshoeing","Glacier","14,411 ft","Epic Views"],desc:"One of the most iconic mountains in North America â€” essentially in JBLM's backyard. Hundreds of trails from easy day hikes to the summit (14,411 ft). Free with your military ID. Non-negotiable on your bucket list.",hours:"Open year-round (some roads seasonal)",links:[{l:"ğŸŒ NPS Mt. Rainier",u:"https://www.nps.gov/mora"},{l:"ğŸ“ Paradise Visitor Center",u:"https://maps.google.com/?q=Paradise+Visitor+Center+Mt+Rainier"}]},
  {id:12,name:"Crystal Mountain Ski Resort",cat:"nature",emoji:"ğŸ¿",bg:"rgba(0,194,224,0.08)",badge:"off",loc:"Crystal Mountain Blvd, Enumclaw",dist:"~50 miles",cost:"~$100â€“$150/day",rating:4.7,tags:["Skiing","Snowboarding","Terrain Parks","Mt Rainier Views","Winter"],desc:"Washington's largest ski resort with Mt. Rainier as a backdrop. Excellent beginner through expert terrain. Only about an hour from JBLM. Amazing snowpack most years.",hours:"Nov â€“ Apr season",links:[{l:"ğŸŒ Crystal Mountain",u:"https://www.crystalmountainresort.com"},{l:"ğŸ“ Directions",u:"https://maps.google.com/?q=Crystal+Mountain+Resort+WA"}]},
  {id:13,name:"Tacoma Rainiers Baseball (AAA)",cat:"social",emoji:"âš¾",bg:"rgba(155,114,255,0.1)",badge:"off",loc:"Cheney Stadium, Tacoma",dist:"~8 miles",cost:"$12â€“$30",rating:4.7,tags:["Baseball","Minor League","Mariners Affiliate","Cheap Tickets","Summer"],desc:"AAA affiliate of the Seattle Mariners. Cheney Stadium is an intimate, affordable ballpark â€” watch future MLB stars before they make it big. Great summer nights, cold beer, $12 tickets.",hours:"Aprilâ€“September",links:[{l:"ğŸŒ Buy Tickets",u:"https://www.milb.com/tacoma/tickets"},{l:"ğŸ“ Cheney Stadium",u:"https://maps.google.com/?q=Cheney+Stadium+Tacoma+WA"}]},
  {id:14,name:"Kayaking â€” American Lake & Puget Sound",cat:"outdoor",emoji:"ğŸš£",bg:"rgba(0,194,224,0.08)",badge:"off",loc:"American Lake / Steilacoom / Gig Harbor",dist:"5â€“15 miles",cost:"MWR Rentals / $15â€“$40",rating:4.5,tags:["Kayaking","Paddleboard","MWR Rentals","Puget Sound","Views"],desc:"JBLM borders American Lake and is minutes from Puget Sound. MWR rents kayaks and paddleboards at MWR rates. Commercial options in Gig Harbor and Steilacoom. Paddle with Mt. Rainier views.",links:[{l:"ğŸŒ JBLM Outdoor Rec",u:"https://www.jblmfmwr.com/outdoor-recreation"},{l:"ğŸ“ American Lake",u:"https://maps.google.com/?q=American+Lake+JBLM+WA"}]},
];

function renderExplore() {
  document.getElementById('exploreCount').textContent = ACTIVITIES.length + '';
  filterExplore();
}

function filterExplore() {
  let filtered = ACTIVITIES.filter(a => {
    const matchCat = currentExploreCat === 'all' || a.cat === currentExploreCat;
    const q = searchQuery.toLowerCase();
    const matchSearch = !q || a.name.toLowerCase().includes(q) || a.desc.toLowerCase().includes(q) || a.tags.some(t => t.toLowerCase().includes(q));
    return matchCat && matchSearch;
  });

  document.getElementById('exploreCount').textContent = filtered.length + '';
  const container = document.getElementById('exploreContainer');

  if (!filtered.length) {
    container.innerHTML = `<div class="empty"><div class="empty-icon">ğŸ”</div><div class="empty-title">No results</div></div>`;
    return;
  }

  container.innerHTML = filtered.map((a,i) => `
    <div class="activity-card" onclick="openActivityModal(${a.id})" style="animation-delay:${i*0.04}s">
      <div class="ac-top">
        <div class="ac-emoji" style="background:${a.bg}">${a.emoji}</div>
        <div class="ac-info">
          <div class="ac-name">${a.name}</div>
          <div class="ac-meta">
            <span class="ac-dist">ğŸ“ ${a.loc.split(',')[0]}</span>
            ${a.rating ? `<span class="ac-rating">â­ ${a.rating}</span>` : ''}
            <span class="${a.badge==='on'?'badge-on':'badge-off'}">${a.badge==='on'?'ON BASE':a.dist}</span>
          </div>
        </div>
        <div class="ac-chevron">â€º</div>
      </div>
      <div class="ac-preview">${a.desc}</div>
      <div class="ac-tags">${a.tags.slice(0,4).map(t=>`<span class="tag">${t}</span>`).join('')}</div>
    </div>
  `).join('');
}

document.getElementById('exploreFilters').addEventListener('click', e => {
  const btn = e.target.closest('.filt-btn');
  if (!btn) return;
  document.querySelectorAll('#exploreFilters .filt-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  currentExploreCat = btn.dataset.cat;
  filterExplore();
});

document.getElementById('searchInput').addEventListener('input', e => {
  searchQuery = e.target.value;
  filterExplore();
});

function openActivityModal(id) {
  const a = ACTIVITIES.find(x => x.id === id);
  if (!a) return;
  document.getElementById('mEmoji').textContent = a.emoji;
  document.getElementById('mEmoji').style.background = a.bg;
  document.getElementById('mTitle').textContent = a.name;
  document.getElementById('mSubtitle').textContent = a.cat.toUpperCase() + ' â€¢ ' + (a.badge==='on' ? 'On Base' : a.dist + ' from JBLM');
  document.getElementById('mBody').innerHTML = `
    <div class="m-section">About</div>
    <div class="m-text">${a.desc}</div>
    <div class="m-grid" style="margin-top:12px">
      <div class="m-pill"><div class="lbl">Cost</div><div class="val g">${a.cost}</div></div>
      <div class="m-pill"><div class="lbl">Distance</div><div class="val">${a.dist}</div></div>
      ${a.hours ? `<div class="m-pill" style="grid-column:span 2"><div class="lbl">Hours</div><div class="val">${a.hours}</div></div>` : ''}
    </div>
    <div class="m-section">Tags</div>
    <div class="m-tags">${a.tags.map(t=>`<div class="m-tag">${t}</div>`).join('')}</div>
    ${a.links?.length ? `<div class="m-section">Links & Directions</div><div class="m-links">${a.links.map(l=>`<a class="m-link" href="${l.u}" target="_blank"><span>${l.l}</span><span>â†—</span></a>`).join('')}</div>` : ''}
  `;
  document.getElementById('modalOverlay').classList.add('open');
  document.body.style.overflow = 'hidden';
}

// â•â•â• RESOURCES â•â•â•
const RESOURCES = [
  {e:"ğŸŒ",n:"JBLM MWR Portal",s:"Events, rentals, leagues",u:"https://www.jblmfmwr.com"},
  {e:"ğŸ–ï¸",n:"JBLM Homepage",s:"Base directory & info",u:"https://home.army.mil/lewis-mcchord"},
  {e:"ğŸ¦Œ",n:"WDFW Hunting",s:"Seasons & licenses",u:"https://wdfw.wa.gov/hunting"},
  {e:"ğŸ£",n:"WDFW Fishing",s:"Reports & regulations",u:"https://wdfw.wa.gov/fishing"},
  {e:"ğŸ”ï¸",n:"WA State Parks",s:"Camping & discover pass",u:"https://parks.wa.gov"},
  {e:"ğŸ–ï¸",n:"NPS Military Pass",s:"Free with military ID",u:"https://www.nps.gov/planyourvisit/military.htm"},
  {e:"ğŸµ",n:"Concert Finder",s:"Tacoma & Seattle shows",u:"https://www.songkick.com/metro-areas/24490-us-tacoma"},
  {e:"âš”ï¸",n:"D&D Beyond",s:"Character builder & rules",u:"https://www.dndbeyond.com"},
  {e:"ğŸ§­",n:"AllTrails â€” JBLM",s:"Hikes & trail maps",u:"https://www.alltrails.com/us/washington/tacoma"},
  {e:"ğŸ«",n:"Ticketmaster API",s:"Get free API key",u:"https://developer.ticketmaster.com"},
];

function renderResources() {
  document.getElementById('resourcesGrid').innerHTML = RESOURCES.map(r => `
    <a class="res-card" href="${r.u}" target="_blank">
      <div class="res-emoji">${r.e}</div>
      <div class="res-name">${r.n}</div>
      <div class="res-sub">${r.s}</div>
    </a>
  `).join('');
}

// â•â•â• MODAL â•â•â•
function closeModal() {
  document.getElementById('modalOverlay').classList.remove('open');
  document.body.style.overflow = '';
}
document.getElementById('modalOverlay').addEventListener('click', e => {
  if (e.target === document.getElementById('modalOverlay')) closeModal();
});
// Swipe down to close
let _sy = 0;
document.getElementById('modalContent').addEventListener('touchstart', e => { _sy = e.touches[0].clientY; },{passive:true});
document.getElementById('modalContent').addEventListener('touchend', e => {
  if (e.changedTouches[0].clientY - _sy > 80) closeModal();
},{passive:true});

// â•â•â• NAV â•â•â•
function switchView(name, btn) {
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('view-' + name).classList.add('active');
  btn.classList.add('active');
}

// â•â•â• HELPERS â•â•â•
function buildSkeletons(n) {
  return '<div class="skeleton-wrap">' + Array(n).fill(`<div class="skeleton" style="height:82px"></div>`).join('') + '</div>';
}

function updateLiveStatus() {
  const now = new Date();
  document.getElementById('liveStatus').textContent = `Updated ${now.getHours()}:${String(now.getMinutes()).padStart(2,'0')}`;
}

function refreshAll() {
  loadEvents();
  showToast('ğŸ”„ Refreshing live data...');
}

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2500);
}

// â•â•â• AUTO REFRESH every 30 minutes â•â•â•
setInterval(() => { if (apiKey) loadEvents(); }, 30 * 60 * 1000);

// â•â•â• START â•â•â•
init();
</script>
</body>
</html>
